<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="כלי אינטראקטיבי ליצירה והדמיה של L-Systems. כל הקוד פתוח לשימוש חופשי.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="_qVtoJcz1_0a-mnbIMEiI6IF1zTH-ulpJiD6iZOSQ2k" />
	<meta property="og:title" content="L system">
  	<meta property="og:description" content="free L system editor">
  	<meta property="og:image" content="https://hananel42.github.io/L-system-studio/icon.png">
	<meta property="og:url" content="https://hananel42.github.io/L-system-studio/">
  	<meta property="og:type" content="website">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0ea5e9">
    <title>L-System Studio</title>
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <div id="app">
        <canvas id="canvas"></canvas>
        <button id="resetBtn" style="position:absolute;top:10px;left:10px;z-index:10;">Reset View</button>
        <button id="editorToggle" style="position:absolute;top:10px;right:10px;z-index:51;">Open Editor</button>

        <aside id="editor">
            <h2>Editor</h2>
            <button onclick="showGuide()">מדריך</button>
            <div id="guideBox" dir="rtl">
                <h2>מדריך שימוש בעורך L-System</h2>
                <p>
                    • התחל מהגדרת <b>אקסיומה</b> (לדוגמה F). הוסף <b>כללים</b> על ידי ציון תו שמוחלף במחרוזת אחרת
                    (לדוגמה F → F+F−F).</br>
                    • לכל <b>סמל</b> ניתן לבחור פעולה (ציור קו, פניה ימינה/שמאלה,שמירת מיקום הסמן ושחזור),
                    וגם לשנות צבע, אורך, וזווית. </br>
                    • הגדל את מספר האיטרציות כדי לקבל צורות מורכבות יותר.</br>
                    • השתמש בקנבס כדי לראות את התוצאה – גרור עם העכבר להזזה וגלגלת/מגע לזום.</br>

                    • תוכל להעתיק קישור או להוריד קובץ JSON כדי לשתף.
                </p>
                <button onclick="hideGuide()">סגור</button>
            </div>
            <div>
                <label>Axiom</label>
                <input id="axiomInput" />
            </div>
            <div>
                <label>Rules</label>
                <div id="rules"></div>
                <button id="addRuleBtn">+ Add Rule</button>
            </div>
            <div>
                <label>Iterations</label>
                <input type="number" id="iterationsInput" />
            </div>
			<div class="light-border">
			<details>
			    <summary>Symbols</summary>
			    <div id="symbols"></div>
				
				<div>
					<label>Add New Symbol</label>
					<div class="new-symbol-row">
						<input id="newSym" placeholder="Symbol" maxlength="1" size="2" />
						<select id="newSymType">
							<option value="draw">Draw</option>
							<option value="turn">Turn</option>
							<option value="push">Push</option>
							<option value="pop">Pop</option>
						</select>
						<input id="newSymValue" placeholder="Value" size="2" />
						<input type="color" id="newSymColor" value="#000000" class="symInput" size="2" />
						<button id="addSymBtn">Add</button>
					</div>
					<label>Background Color  -  </label><input type="color" id="bgColorPicker" value="#ffffff" />
				</div>

			  
			</details>
			</div>

            
			<div>
                <label>Generated String</label><br />
                <textarea id="genString" readonly></textarea>
            </div>
			
			</br>
			
			<select id="exampleSelect">
                <option value="">-- Select Example --</option>
            </select>
			
			</br></br>
			
			<div class="light-border">
				<button id="saveBtn">Save JSON</button>
				<label for="loadInput" class="file-label">Load JSON</label>
				<input type="file" id="loadInput" />
				<button id="svgBtn">Export SVG</button>
				<button id="pngBtn">Export PNG</button>
				<button id="shareBtn">Share Link</button>
			</div>
            
			
			</br>
			<div class="light-border">
			<details>
			    <summary>Aimation</summary>
				</br>
				<select id="animType">
					<option value="none">off</option>
					<option value="steps">Step by step</option>
					<option value="tree">Tree</option>
				</select>
				</br></br>
			    <label>Speed : </label><input id="animSpeed" placeholder="speed" size="2" type="number" value="5" />
				<button id="animBtn">Restart</button>
			</details>
			</div>
			

        </aside>
    </div>

    <div id="notice" class="notice"></div>

    <script src="lsystem.js"></script>
	<script src="ctx.js"></script>
	<script src="editor.js"></script>
	<script src="export.js"></script>
    <script>
        
		
        // ---- Helpers ----
        window.showNotice = function (msg, timeout = 3000) {
            const n = document.getElementById('notice');
            n.textContent = msg;
            n.style.display = 'block';
            clearTimeout(n._t);
            n._t = setTimeout(() => n.style.display = 'none', timeout);
        }
        window.escapeHtml = function (s) {return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');}

        window.update = function () {
            shapeData = genLSystem(params);
			if (params.animType=="tree"){ shapeData.tree = buildLSystemTree(params);}
            document.getElementById('genString').value = shapeData.meta.text;
			animI=0;
        }
		window.loadParams = function(newparams){
			params = {...params,...newparams};
			document.getElementById('bgColorPicker').value = params.bg; 
			canvas.style.background = params.bg; 
			document.getElementById('animType').value = params.animType;
			document.getElementById('animSpeed').value = params.animSpeed; 					
			update();
		}
		window.loadParamsFromURL = function () {
			const urlParams = new URLSearchParams(location.search);
			const encoded = urlParams.get("data");
			if (encoded) {
				try {
					const json = decodeURIComponent(escape(atob(encoded)));
					loadParams(JSON.parse(json));
					refreshEditor();
					showNotice("Loaded shared configuration from URL.");
				} catch (e) {
					console.error(e);
					showNotice("Invalid shared link.");
				}
			}
		}
       
        window.paramsToURL = function (params) {
            const json = JSON.stringify(params);
            return btoa(unescape(encodeURIComponent(json)));
        }
		

        loadParamsFromURL();
    </script>
	
</body>
</html>





